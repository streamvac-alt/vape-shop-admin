<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî Vape Shop</title>
  <style>
    body { font-family: -apple-system, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f8f9fa; }
    input, button, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 10px; font-size: 16px; }
    button { background: #0088cc; color: white; border: none; cursor: pointer; font-weight: bold; }
    .delete-btn { background: #e53935; width: auto; display: inline-block; margin: 0 4px; }
    .product-card { background: white; padding: 16px; margin: 12px 0; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
    .product-img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; margin: 8px 0; }
  </style>
</head>
<body>
  <div style="max-width:800px; margin:0 auto; padding:20px;">
    <h2>üõ† –ê–¥–º–∏–Ω–∫–∞ ‚Äî Vape Shop</h2>
    
    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å / –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
    <input type="text" id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
    <div style="display:flex; gap:8px;">
      <input type="number" id="price" placeholder="–¶–µ–Ω–∞ (BYN)" step="0.01">
      <input type="number" id="stock" placeholder="–û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥–µ" min="0">
    </div>
    <input type="text" id="image" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ (–∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–∞ imgbb.com)">
    <select id="category">
      <option value="liquids">–ñ–∏–¥–∫–æ—Å—Ç–∏</option>
      <option value="hardware">–ñ–µ–ª–µ–∑–æ</option>
    </select>
    <input type="text" id="brand" placeholder="–ë—Ä–µ–Ω–¥ (–ª–∞—Ç–∏–Ω–∏—Ü–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä: bad_drip)">
    <input type="hidden" id="edit-index">
    <button onclick="saveProduct()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä</button>

    <h3>üì¶ –¢–æ–≤–∞—Ä—ã</h3>
    <div id="products-list"></div>
  </div>

  <script>
    // ‚Üì‚Üì‚Üì –ó–ê–ú–ï–ù–ò –≠–¢–ò URL –ù–ê –°–í–û–ò ‚Üì‚Üì‚Üì
    const API_URL = "https://vape-shop-api-streamvac-alt.vercel.app/api/update";
    const DATA_URL = "https://vape-shop-data.vercel.app/db.json";
    // ‚Üë‚Üë‚Üë –ó–ê–ú–ï–ù–ò –≠–¢–ò URL –ù–ê –°–í–û–ò ‚Üë‚Üë‚Üë

    let products = [];

    async function loadProducts() {
      const res = await fetch(DATA_URL + "?t=" + Date.now());
      const data = await res.json();
      products = data.products || [];
      renderList();
    }

    function renderList() {
      const list = document.getElementById('products-list');
      list.innerHTML = products.map((p, i) => `
        <div class="product-card">
          <strong>${p.name}</strong><br>
          üí∞ ${parseFloat(p.price).toFixed(2)} BYN | üì¶ –û—Å—Ç–∞—Ç–æ–∫: ${p.stock || 0}<br>
          üè∑Ô∏è –ë—Ä–µ–Ω–¥: ${p.brand || '‚Äî'} | ${p.category === 'liquids' ? '–ñ–∏–¥–∫–æ—Å—Ç—å' : '–ñ–µ–ª–µ–∑–æ'}<br>
          <img src="${p.image}" class="product-img" onerror="this.style.display='none'"><br>
          <button onclick="editProduct(${i})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
          <button class="delete-btn" onclick="deleteProduct(${i})">üóë –£–¥–∞–ª–∏—Ç—å</button>
        </div>
      `).join('');
    }

    function saveProduct() {
      const name = document.getElementById('name').value.trim();
      const price = parseFloat(document.getElementById('price').value);
      const stock = parseInt(document.getElementById('stock').value) || 0;
      const image = document.getElementById('image').value.trim();
      const category = document.getElementById('category').value;
      const brand = document.getElementById('brand').value.trim();

      if (!name || !price || !image) {
        alert("–ó–∞–ø–æ–ª–Ω–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω—É –∏ —Ñ–æ—Ç–æ!");
        return;
      }

      const product = { name, price, stock, image, category, brand };

      const editIndex = document.getElementById('edit-index').value;
      if (editIndex !== '') {
        products[editIndex] = product;
      } else {
        products.push(product);
      }

      fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ products })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("–¢–æ–≤–∞—Ä —Å–æ—Ö—Ä–∞–Ω—ë–Ω!");
          clearForm();
          loadProducts();
        } else {
          throw new Error(data.error || 'Unknown error');
        }
      })
      .catch(err => {
        alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:\n" + err.message);
      });
    }

    function editProduct(index) {
      const p = products[index];
      document.getElementById('name').value = p.name;
      document.getElementById('price').value = p.price;
      document.getElementById('stock').value = p.stock || 0;
      document.getElementById('image').value = p.image;
      document.getElementById('category').value = p.category;
      document.getElementById('brand').value = p.brand || '';
      document.getElementById('edit-index').value = index;
    }

    function deleteProduct(index) {
      if (!confirm("–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?")) return;
      products.splice(index, 1);
      fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ products })
      }).then(() => {
        loadProducts();
        clearForm();
      });
    }

    function clearForm() {
      document.getElementById('name').value = '';
      document.getElementById('price').value = '';
      document.getElementById('stock').value = '';
      document.getElementById('image').value = '';
      document.getElementById('brand').value = '';
      document.getElementById('edit-index').value = '';
    }

    loadProducts();
  </script>
</body>
</html>
